<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Identity Management</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body id="con_introduction-to-keycloak" class="article">
<div id="header">
<h1>Identity Management</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#ref_terminology_Identity Management_ref_terminology">Identity Management Terminology</a></li>
</ul>
</li>
<li><a href="#setup">Prerequisites</a></li>
<li><a href="#_setting_up_the_identity_management_mobile_service">Setting Up the Identity Management Mobile Service</a>
<ul class="sectlevel2">
<li><a href="#_provisioning_the_identity_management_service">Provisioning the Identity Management Service</a></li>
<li><a href="#_binding_a_mobile_client">Binding a Mobile Client</a></li>
<li><a href="#_configuring_the_service">Configuring the Service</a></li>
<li><a href="#_downloading_the_mobile_services_configuration_file">Downloading the Mobile Services Configuration File</a></li>
</ul>
</li>
<li><a href="#_setting_up_identity_management_service_sdk">Setting up Identity Management service SDK</a>
<ul class="sectlevel2">
<li><a href="#_importing_the_libraries">Importing the libraries</a></li>
</ul>
</li>
<li><a href="#_initializing_the_sdk">Initializing the SDK</a></li>
<li><a href="#user-auth">Adding User Authentication to your Mobile App</a>
<ul class="sectlevel2">
<li><a href="#_implementing_authentication">Implementing authentication</a></li>
<li><a href="#_refreshing_the_authentication_token">Refreshing the authentication token</a></li>
<li><a href="#_adding_log_out_option_to_your_mobile_app">Adding Log Out Option to your Mobile App</a></li>
<li><a href="#_authenticating_with_a_back_end_service">Authenticating with a back end service</a></li>
</ul>
</li>
<li><a href="#access">Adding Access Control to your Mobile App</a></li>
<li><a href="#sso">Adding Single Sign-On (SSO) to your Mobile App</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_using_sso_with_the_device_browser">Using SSO with the Device Browser</a></li>
<li><a href="#_known_issues">Known Issues</a></li>
</ul>
</li>
<li><a href="#monitoring">Monitoring the Identity Management Service</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites_2">Prerequisites</a></li>
<li><a href="#_overview">Overview</a></li>
<li><a href="#_dashboard_panel_descriptions">Dashboard panel descriptions</a></li>
<li><a href="#_singlestat_panels">Singlestat Panels</a></li>
<li><a href="#_graph_panels">Graph panels</a></li>
<li><a href="#_pie_charts">Pie Charts</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Identity Management service allows you to add authentication and authorization to your mobile app.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secure your mobile app using the industry standard OpenID Connect protocol</p>
</li>
<li>
<p>Add access control to your app based on user’s group membership</p>
</li>
<li>
<p>Easily implement SSO, multi-factor authentication and Social Login support</p>
</li>
<li>
<p>Back-end support for identity brokering and user federation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="https://www.keycloak.org/documentation.html">Keycloak documentation, window="_blank"</a> for more info.</p>
</div>
<div class="sect2">
<h3 id="ref_terminology_Identity Management_ref_terminology">Identity Management Terminology</h3>
<div class="paragraph">
<p>This section describes terminology that is associated with Identity Management.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SSO</dt>
<dd>
<p><em>Single Sign On</em>, the ability to share a login between multiple services</p>
</dd>
<dt class="hdlist1">OpenID Connect</dt>
<dd>
<p>a standard for providing identity on top of OAuth 2.0</p>
</dd>
<dt class="hdlist1">Keycloak</dt>
<dd>
<p>Red Hat&#8217;s implementation of <em>SSO</em> and <em>OpenID</em> used as the identity provider</p>
</dd>
<dt class="hdlist1">Client ID</dt>
<dd>
<p>is the client identifier for <em>OpenID Connect</em> requests, a simple alpha-numeric string</p>
</dd>
<dt class="hdlist1">User Attributes</dt>
<dd>
<p>additional properties for user accounts (besides name and email) managed by Keycloak</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup">Prerequisites</h2>
<div class="sectionbody">
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10003; You are running OpenShift with Mobile Services as described in <a href="#getting-started.adoc">Setting up AeroGear Mobile Services on OpenShift</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_the_identity_management_mobile_service">Setting Up the Identity Management Mobile Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_provisioning_the_identity_management_service">Provisioning the Identity Management Service</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log into the OpenShift console.</p>
</li>
<li>
<p>Create a new project or choose an existing project.</p>
</li>
<li>
<p>Click <strong>Add to Project</strong> and choose <strong>Browse Catalog</strong> from the options.</p>
<div class="paragraph">
<p>You can filter the catalog items to only show mobile specific items by clicking the <strong>Mobile</strong> tab.</p>
</div>
</li>
<li>
<p>Click <strong>Services</strong> and choose the Identity Management service.</p>
<div class="imageblock">
<div class="content">
<img src="catalog-mobile-services.png" alt="catalog mobile services">
</div>
</div>
</li>
<li>
<p>Follow the wizard for provisioning that service.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If prompted to <strong>Create a Binding</strong>, choose <strong>Do not bind at this time</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When provisioning an Identity Management service, you are prompted to set the following configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Keycloak admin username</strong>: Username for Keycloak administration</p>
</li>
<li>
<p><strong>Keycloak admin password</strong>: Password for the Keycloak admin user</p>
</li>
<li>
<p><strong>Name of the Keycloak realm</strong>: Name of the keycloak realm. (defaults to current namespace)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A realm manages a set of users, credentials, roles, and groups. A user belongs to and logs into a realm. Realms are isolated from one another and can only manage and authenticate the users that they control.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Connect to an existing shared service</strong>: Select if you want to use an existing service and you have the URL and credentials to use that service.</p>
</li>
<li>
<p><strong>URL of the shared service</strong>: Enter a value if you want to use an existing shared service.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the wizard steps are completed, navigate to the Project Overview in OpenShift to see the newly provisioned service.
Provisioning a service may take some time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_binding_a_mobile_client">Binding a Mobile Client</h3>
<div class="paragraph">
<p>To use mobile services, you must represent your mobile app in OpenShift using a Mobile Client, and that Mobile Client must be associated with the mobile service.
This association is called <strong>binding</strong> and it is necessary for your mobile app to use that service.</p>
</div>
<div class="paragraph">
<p>To bind a Mobile Client with a mobile service:</p>
</div>
<div class="sect3">
<h4 id="_procedure">Procedure</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Overview</strong> of your OpenShift project.</p>
</li>
<li>
<p>Select the Mobile Client name listed in the Mobile Clients section.</p>
</li>
<li>
<p>Navigate to <strong>Mobile Services</strong> tab.</p>
<div class="imageblock">
<div class="content">
<img src="mobile-clients-services-all-unbound.png" alt="mobile clients services all unbound">
</div>
</div>
</li>
<li>
<p>Click <strong>Create Binding</strong> and follow the <strong>Create Binding</strong> wizard to associate the Mobile Client with the Identity Management Service.</p>
</li>
<li>
<p>Fill out the binding parameters required by the Identity Management Service.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Use <code>public</code> when binding a Mobile Client to a Identity Management. When binding mobile services to each other, use <code>bearer</code>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Identity Management service will now be expandable, details about the service can be viewed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="mobile-clients-services-all-idm-provisioned.png" alt="mobile clients services all idm provisioned">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_service">Configuring the Service</h3>
<div class="paragraph">
<p>The following section will guide you through configuring the schema of the redirect url and web origin for a client in Keycloak.
This is required to enable OpenID authentication.
For an explanation of these terms, see <a href="https://www.keycloak.org/documentation.html">Keycloak Documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="choose-schema">Choose the schema of a redirect url</h4>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="paragraph">
<p>It is recommended to use the package name of the Android app as the schema of the redirect url to avoid conflicts. (e.g. <code>com.aerogear.androidshowcase</code>)</p>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="paragraph">
<p>It is recommended to use the Bundle Identifier of the iOS app as the schema of the redirect url. (e.g. <code>org.aerogear.ios-showcase-template</code>)</p>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>Redirect url is <code>http://localhost/*</code>, without <code>:/callback</code>. Web Origin is <code>http://localhost/*</code>.</p>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="paragraph">
<p>Depending on the platform, set the redirect as described in either the Android or the iOS tab.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_keycloak">Configuring Keycloak</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log into the OpenShift console and navigate to the Project Overview.</p>
</li>
<li>
<p>Navigate to the Mobile Client screen.</p>
</li>
<li>
<p>Select the Mobile Services tab.</p>
</li>
<li>
<p>If a binding to the Identity Management service is in progress, a spinning icon is displayed to the right of the Identity Management entry. Wait for the binding process to complete.</p>
</li>
<li>
<p>If the <em>Keycloak Realm URL</em> URL is not visible, expand the Identity Management Service by clicking the &gt; icon.</p>
</li>
<li>
<p>Click on the <strong>Keycloak Realm URL</strong> link to open the Keycloak Administration Console.</p>
</li>
<li>
<p>Log in to the Administration console using the credentials you specified when <a href="#provisioning-the-identity-management-service">Provisioning</a> the service (defaults to admin:admin).</p>
</li>
<li>
<p>Select <code>Clients</code> from the left navigation menu.</p>
</li>
<li>
<p>Select your client from the list of clients. The name of your client is derived from the name of the Mobile Client, the name of the mobile development platform and the client type, for example <code>myapp-android-public</code>.</p>
</li>
<li>
<p>Add <code>&lt;schema&gt;:/callback</code> as an additional entry to <code>Valid Redirect URIs</code>. See <a href="#choose-schema">Choose the schema of a redirect url</a> to determine the value for <code>&lt;schema&gt;</code>.</p>
</li>
<li>
<p>Add <code>&lt;schema&gt;</code> as an additional entry to <code>Web Origins</code>.  See <a href="#choose-schema">Choose the schema of a redirect url</a> to determine the value for <code>&lt;schema&gt;</code>.</p>
</li>
<li>
<p>Save your changes.</p>
</li>
<li>
<p>Create a new user account as described in <a href="https://www.keycloak.org/docs/3.3/server_admin/topics/users/create-user.html">Creating a New User</a>.</p>
</li>
<li>
<p>Set up credentials for the new user as described in <a href="https://www.keycloak.org/docs/3.3/server_admin/topics/users/credentials.html">User Credentials</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_downloading_the_mobile_services_configuration_file">Downloading the Mobile Services Configuration File</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to your project in OpenShift.</p>
</li>
<li>
<p>On the <strong>Overview</strong> screen, expand your Mobile Client to view the <strong>CLIENT INFO</strong>.</p>
</li>
<li>
<p>Copy the configuration to your clipboard.</p>
</li>
<li>
<p>Save the contents of the clipboard to a new file called <code>mobile-services.json</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The mobile-services.json file is the link between your provisioned services on OpenShift and the mobile app you are developing. This file provides all required configuration to initialise the various SDKs and get them hooked up/connected to the back-end services.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Follow the platform-specific instructions:</p>
</li>
</ol>
</div>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="paragraph">
<p>Move mobile-services.json to the following location in your application project:</p>
</div>
<div class="paragraph">
<p><code>app/src/main/assets/mobile-services.json</code></p>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="paragraph">
<p>Move mobile-services.json to the following location in your application project:</p>
</div>
<div class="paragraph">
<p><code>&lt;app directory&gt;/mobile-services.json</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Ensure that <code>mobile-services.json</code> is a member of the project in the Xcode Project Navigator.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>Move mobile-services.json to the following location in your application project:</p>
</div>
<div class="paragraph">
<p><code>src/mobile-services.json</code></p>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="paragraph">
<p>Move mobile-services.json to the following location in your application project:</p>
</div>
<div class="paragraph">
<p><code>Resources/mobile-services.json</code></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_identity_management_service_sdk">Setting up Identity Management service SDK</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will help you to set up the Identity Management service SDK in your App.</p>
</div>
<div class="sect2">
<h3 id="_importing_the_libraries">Importing the libraries</h3>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following dependency in your app&#8217;s <strong>build.gradle</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    implementation "org.aerogear:android-auth:1.0.0"
}</code></pre>
</div>
</div>
</li>
<li>
<p>To prevent build errors, add the following in your app&#8217;s <strong>build.gradle</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compileOptions {
    sourceCompatibility 1.8
    targetCompatibility 1.8
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the dependency to your <strong>Podfile</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">target '[TARGET NAME]' do
    pod 'AGSAuth', '1.0.0'
end</code></pre>
</div>
</div>
</li>
<li>
<p>Update the dependencies:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ pod install</code></pre>
</div>
</div>
</li>
<li>
<p>Import and instantiate <code>AGSAuth</code> to start using the SDK:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import AGSAuth

auth = AGSAuth()</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>Install the <a href="https://www.npmjs.com/package/@aerogear/auth">AeroGear Auth</a> package from <a href="https://www.npmjs.com/">NPM, window="_blank"</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ npm install @aerogear/auth</code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <a href="https://docs.microsoft.com/en-us/nuget/install-nuget-client-tools">NuGet, window="_blank"</a>.</p>
</li>
<li>
<p>Install the <a href="https://www.nuget.org/packages/AeroGear.Mobile.Core">AeroGear Core, window="_blank"</a> package:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dotnet add package AeroGear.Mobile.Core --version 1.0.0</code></pre>
</div>
</div>
</li>
<li>
<p>For Android run:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dotnet add package AeroGear.Mobile.Core.Platform.Android --version 1.0.0
dotnet add package AeroGear.Mobile.Auth.Platform.Android --version 1.0.0</code></pre>
</div>
</div>
</li>
<li>
<p>For iOS run:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">dotnet add package AeroGear.Mobile.Core.Platform.iOS --version 1.0.0
dotnet add package AeroGear.Mobile.Auth.Platform.iOS --version 1.0.0</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initializing_the_sdk">Initializing the SDK</h2>
<div class="sectionbody">
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the redirect URL. It is recommended to use the package name of your app.</p>
<div class="listingblock">
<div class="content">
<pre>AuthServiceConfiguration authServiceConfig = new AuthServiceConfiguration
    .AuthConfigurationBuilder()
    .withRedirectUri("org.aerogear.mobile.example:/callback")
    .build();</pre>
</div>
</div>
</li>
<li>
<p>Create the auth service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">AuthService authService = new AuthService(authServiceConfig);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="paragraph">
<p>Set your custom configuration to the auth service instance, making sure the redirect URL matches the App&#8217;s Bundle Id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">// create the authentication config
let authenticationConfig = AuthenticationConfig(redirectURL: "org.aerogear.mobile.example:/callback")
try! AgsAuth.instance.configure(authConfig: authenticationConfig, useExternalUserAgent: false)</code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>Import and initialize Auth:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const Auth = require('@aerogear/auth').Auth;

const authService = new Auth();
const initOptions = { onLoad: "login-required" };

authService.init(initOptions)
    .then(() =&gt; {
        // successful init &amp; authentication
    })
    .catch((err) =&gt; {
        // initialization error
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can pass <code>login-required</code> or <code>check-sso</code> to the init function. <code>login-required</code> will authenticate the client if the user is logged in to Keycloak or display the login page if not. <code>check-sso</code> will only authenticate the client if the user is already logged in. If the user is not logged in the browser will be redirected back to the application and remain unauthenticated. By default, the <code>check-sso</code> option is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Initialization will also perform authentication
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an <a href="https://developer.android.com/guide/topics/manifest/manifest-intro#ifs">intent filter, window="_blank"</a> for the <code>net.openid.appauth.RedirectUriReceiverActivity</code> activity. This step is required for Xamarin Android and allows the login browser to redirect back to your App. Add this to your <code>AndroidManifest.xml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activity android:name="net.openid.appauth.RedirectUriReceiverActivity" android:exported="true"  android:icon="@mipmap/ic_launcher" android:roundIcon="@mipmap/ic_launcher_round"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.VIEW" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
        &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
        &lt;data android:scheme="org.aerogear.mobile.example" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Initialize the Auth module</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For an Android app (MainActivity.cs):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var app = new App();
MobileCoreAndroid.Init(app.GetType().Assembly,ApplicationContext);
var authService = AuthService.InitializeService();
var authConfig = AuthenticationConfig.Builder.RedirectUri("org.aerogear.mobile.example:/callback").Build();
authService.Configure(authConfig);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For Android an <a href="https://developer.android.com/guide/topics/manifest/manifest-intro#ifs">Intent filter, window="_blank"</a> should be configured with the callback URL specified in AuthenticateOptions in the App&#8217;s AndroidManifest.xml. See the <a href="https://github.com/aerogear/xamarin-showcase-template/blob/master/Example.Android/Properties/AndroidManifest.xml">example app, window="_blank"</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For an iOS app (FinishedLaunching method of AppDelegate.cs):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">var app = new App();
MobileCore core = MobileCoreIOS.Init(app.GetType().Assembly);
var authService = AuthService.InitializeService();
var authConfig = AuthenticationConfig.Builder.RedirectUri("org.aerogear.mobile.example:/callback").Build();
authService.Configure(authConfig);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>To use self-signed certificates with Xamarin Android:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a file at <code>Resources/xml/network_security_config.xml</code> with the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;network-security-config&gt;
  &lt;base-config&gt;
    &lt;trust-anchors&gt;
      &lt;certificates src="user"/&gt;
      &lt;certificates src="system"/&gt;
    &lt;/trust-anchors&gt;
  &lt;/base-config&gt;
&lt;/network-security-config&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following value to the <code>&lt;application&gt;</code> tag in <code>AndroidManifest.xml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">android:networkSecurityConfig="@xml/network_security_config"</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user-auth">Adding User Authentication to your Mobile App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to perform user authentication for the supported platforms. On authentication a browser window will open and prompt the user for login credentials.</p>
</div>
<div class="sect2">
<h3 id="_implementing_authentication">Implementing authentication</h3>
<div class="paragraph">
<p>The following examples show how to implement authentication using the Aerogear SDK on all the supported platforms.</p>
</div>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Provide an implementation of <code>Callback</code> which is defined in the Aerogear SDK and used to handle asynchronous results:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Callback authCallback = new Callback&lt;UserPrincipal&gt;() {
    @Override
    public void onSuccess(UserPrincipal principal) {
        ...
    }

    @Override
    public void onError(Throwable error) {
        ...
    }
};</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>login</code> method to hand over to the login browser:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Build the options object and start the authentication flow
DefaultAuthenticateOptions options = new DefaultAuthenticateOptions(myActivity, LOGIN_RESULT_CODE);

authService.login(options, authCallback);</code></pre>
</div>
</div>
</li>
<li>
<p>Override <code>onActivityResult</code> to handle the result from the browser. It&#8217;s important to pass the intent back to the Auth service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
public void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == LOGIN_RESULT_CODE) {
        authService.handleAuthResult(data);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This handler should always invoke <code>handleAuthResult</code>, providing the <code>Intent</code>. This will exchange the temporary tokens returned from <code>login</code> for long-lived tokens and will provide a <code>UserPrincipal</code> which can be used to access a users details. If this is not invoked you will not have access to the <code>UserPrincipal</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The callback provided to <code>login</code> will be invoked.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>login</code> method to hand over to the login browser:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">AgsAuth.instance.login(presentingViewController: self, onCompleted: onLoginComplete)

func onLoginComplete(user: User?, err: Error?) {
    if let error = err {
        return
    }

    let currentUser = user
}</code></pre>
</div>
</div>
</li>
<li>
<p>Allow your application to handle the redirect in <code>AppDelegate</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">func application(_ app: UIApplication, open url: URL, options: [UIApplicationOpenURLOptionsKey: Any] = [:]) -&gt; Bool {
    do {
        return try AgsAuth.instance.resumeAuth(url: url as URL)
    } catch AgsAuth.Errors.serviceNotConfigured {
        print("AeroGear auth service is not configured")
    } catch {
        fatalError("Unexpected error: \(error).")
    }
    return false
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>Authentication will be performed on initialization as described <a href="keycloak/coding.html#initializing-the-sdk">here</a>. To manually redirect to the login screen, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">authService.login().then(() =&gt; {
    // Login success
}).catch(() =&gt; {
    // Login error
});;</code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>Authenticate</code> method to hand over to the login browser:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">IAuthService authService = MobileCore.Instance.GetService&lt;IAuthService&gt;();

var authOptions = DependencyService.Get&lt;IAuthenticateOptionsProvider&gt;().GetOptions();
var user = await authService.Authenticate(authOptions);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_refreshing_the_authentication_token">Refreshing the authentication token</h3>
<div class="paragraph">
<p>When a user is authenticated, an access token and a refresh token are generated by the authentication server.
See the <a href="https://www.keycloak.org/docs/3.2/server_admin/topics/sessions/timeouts.html">Keycloak documentation</a> for information about configuring the lifespan of these tokens.
If the refresh token is still valid, the authentication token can be refreshed even if the authentication token has expired.
The following code shows how the authentication token can be refreshed automatically:</p>
</div>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="paragraph">
<p>Retrieve the current user and refresh the access token when possible and required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">UserPrincipal currentUser = authService.currentUser(true);</code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="paragraph">
<p>Retrieve the current user and refresh the access token when possible and required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">do {
    try AgsAuth.instance.currentUser(autoRefresh: true) { (currentUser, error) in
        // If error is nil, currentUser is now refreshed
    }
} catch {
    // An error has occurred trying to reach the authentication server
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>Retrieve the keycloak adapter object and refresh the access token, when possible and required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">authService.service.extract().updateToken(30).then(() =&gt; {
    // Token has been refreshed
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about the keycloak javascript adapter can be found <a href="https://www.keycloak.org/docs/3.0/securing_apps/topics/oidc/javascript-adapter.html">here</a></p>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="paragraph">
<p>Retrieve the current user and refresh, if needed and still possible, its access token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var authService = MobileCore.Instance.GetService&lt;IAuthService&gt;();
var currentUser = await authService.CurrentUser(true);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_log_out_option_to_your_mobile_app">Adding Log Out Option to your Mobile App</h3>
<div class="paragraph">
<p>The following section describes how to perform a logout.</p>
</div>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the current user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">UserPrincipal currentUser = authService.currentUser();</code></pre>
</div>
</div>
</li>
<li>
<p>Implement <code>Callback</code> and call <code>logout</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>authService.logout(currentUser, new Callback&lt;UserPrincipal&gt;() {
    @Override
    public void onSuccess() {
        // User Logged Out Successfully and local Auth tokens were Deleted
    }

    @Override
    public void onError(Throwable error) {
        // An error occurred during logout
    }
});</pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement the logout callback:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">func onLogoutComplete(_: Error?) {
    // User Logged Out Successfully and local Auth tokens were Deleted
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>Call <code>logout</code> and pass the callback:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">do {
    try AgsAuth.instance.logout(onCompleted: self.onLogoutComplete)
} catch {
    fatalError("Error logging out: \(error).")
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>To logout invoke the <code>logout</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">authService.logout().then(() =&gt; {
    // User Logged Out Successfully and local Auth tokens were Deleted
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="paragraph">
<p>To logout invoke the <code>Logout</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var authService = MobileCore.Instance.GetService&lt;IAuthService&gt;();
var result = await authService.Logout(authService.CurrentUser());</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To perform <strong>backchannel or federated logouts</strong>, you must enable the Backchannel Logout option for the federated identity provider. More information is available in the Keycloak documentation under <a href="https://www.keycloak.org/docs/3.3/server_admin/topics/identity-broker/oidc.html">OICD Identity Providers, window="_blank"</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_authenticating_with_a_back_end_service">Authenticating with a back end service</h3>
<div class="paragraph">
<p>In a typical scenario, you not only want the user to authenticate on the mobile app, you also want that user to authenticate with a back end service. To achieve this, you must add an additional token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Authorization: BEARER Yourtoken</code></pre>
</div>
</div>
<div class="paragraph">
<p>SDK also provides number of helpers to build authentication headers that will provide way to refresh it once token is outdated.</p>
</div>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the <code>AuthHeaderProvider</code> instance provided by the Aerogear SDK:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">authService.getAuthHeaderProvider()</code></pre>
</div>
</div>
</li>
<li>
<p>Plug it into your networking layer. When using the <code>okhttp</code> library, this can be added to the list of request interceptors to automatically supply the required tokens:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">MobileCore.getInstance()
          .getHttpLayer()
          .requestHeaderInterceptor()
          .add(authService.getAuthHeaderProvider());</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the <code>AuthHeaderProvider</code> instance provided by the Aerogear SDK:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">authService.getAuthHeaderProvider()</code></pre>
</div>
</div>
</li>
<li>
<p>Plug it into your networking layer.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>The AeroGear Cordova SDK doesn&#8217;t provide an HTTP layer, therefore it cannot provide an Auth Header Provider.
You must manually attach the <code>Bearer</code> header to your HTTP requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">req.setRequestHeader('Accept', 'application/json');
req.setRequestHeader('Authorization', 'Bearer ' + authService.extract().token);</code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the <code>AuthHeaderProvider</code> instance provided by the Aerogear SDK:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var authHeaderProvider = authService.AuthHeaderProvider;</code></pre>
</div>
</div>
</li>
<li>
<p>Plug it into your networking layer.</p>
</li>
</ol>
</div>
</div>
</div>
<h3 id="_additional_information" class="discrete">Additional Information</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#android-additional-configuration">Additional configuration for Android</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/3.3/server_admin/topics/identity-broker/oidc.html">Keycloak OICD Providers, window="_blank"</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="access">Adding Access Control to your Mobile App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once a <code>UserPrincipal</code> has been retrieved, the <a href="http://www.keycloak.org/docs/latest/server_admin/index.html#roles">roles, window="_blank"</a> of the user can be listed and checked. This can be used to perform client side access control, such as hiding UI components related to actions the user doesn&#8217;t have permissions to perform.</p>
</div>
<div class="paragraph">
<p>Roles are divided into two types. Resource roles which belong to the client the user has authenticated against, and Realm roles which belong to the realm the client is in.</p>
</div>
<div class="sidebarblock primary">
<div class="content">
<div class="title">Android</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the authenticated user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">UserPrincipal currentUser = authService.currentUser();</code></pre>
</div>
</div>
</li>
<li>
<p>Use <code>hasRealmRole</code> and <code>hasResourceRole</code> to check for roles:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">boolean hasAdminPermissions = currentUser.hasRealmRole("user_admin");
boolean isModerator = currentUser.hasResourceRole("my_resource", "user_moderator");</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">iOS</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the authenticated user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">let currentUser = try AgsAuth.instance.currentUser()</code></pre>
</div>
</div>
</li>
<li>
<p>The user roles are available on the authenticated user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">let clientRoles = currentUser.clientRoles
let realmRoles = currentUser.realmRoles</code></pre>
</div>
</div>
</li>
<li>
<p>Use <code>hasRealmRole</code> and <code>hasClientRole</code> to check for roles:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">let hasAdminRole = currentUser.hasRealmRole("admin")
let hasModeratorRole = currentUser.hasClientRole(client: "my_client", role: "moderator")</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Cordova</div>
<div class="paragraph">
<p>Get the realm roles from the auth service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const realmRoles = authService.getRealmRoles();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
No function to retrieve the resource roles is currently exported but you can use <code>extract</code> to get a handle to the underlying keycloak-js instance to retrieve the roles from there. Have a look at their documentation <a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_adapter">here, window="_blank"</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sidebarblock secondary">
<div class="content">
<div class="title">Xamarin</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the authenticated user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// auth service is already initialised
var user = MobileCore.Instance.GetService&lt;IAuthService&gt;().CurrentUser();</code></pre>
</div>
</div>
</li>
<li>
<p>Use <code>getRoles</code> to retrieve all roles from the user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// auth service is already initialised
var roles = user.getRoles();</code></pre>
</div>
</div>
</li>
<li>
<p>Use <code>HasRealmRole</code> and <code>HasResourceRole</code> to check for roles:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">bool isAdmin = user.HasRealmRole("user_admin");
bool isModerator = user.HasResourceRole("my_resource", "user_moderator");</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sso">Adding Single Sign-On (SSO) to your Mobile App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Auth SDK uses OpenID Connect <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">Authorization Code Flow</a> to achieve SSO via a mobile device browser.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Two Mobile Clients bound to the Identity Management service</p>
</li>
<li>
<p>Two mobile apps built and running on the same device that are using the AeroGear SDK Auth module</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_sso_with_the_device_browser">Using SSO with the Device Browser</h3>
<div class="paragraph">
<p>For this guide, assume that your two apps are called <strong>Email App</strong> and <strong>Messaging App</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure the "Remember Me" option in Keycloak is turned on. In the admin UI click on <strong>Realm Settings</strong> section on the left hand side, and then click on <strong>Login</strong>. Turn on <strong>Remember Me</strong>.</p>
</li>
<li>
<p>Now that your two apps and Keycloak clients are setup, sign into the <strong>Email App</strong> with the user you have previously created. You should be redirected to your device browser which should have loaded the Keycloak login page.</p>
</li>
<li>
<p>Next, enter in your credentials, make sure check the <strong>Remember Me</strong> option and login. You have now been authenticated on the <strong>Email App</strong> via the browser.</p>
</li>
<li>
<p>Finally, try sign into the <strong>Messaging App</strong> and you should be automatically logged in as you have been previously authenticated in the <strong>Email App</strong> via the <strong><em>same</em></strong> browser.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_known_issues">Known Issues</h3>
<div class="paragraph">
<p>On iOS 11 and above, Apple has introduced <a href="https://developer.apple.com/documentation/safariservices/sfauthenticationsession">SFAuthenticationSession</a> for apps to perform SSO, instead of using the system Safari browser. However, there are a few known issues with this new feature and sometimes user may have to enter their credentials again in other apps, even if they have already logged in once previously in one of the apps.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring">Monitoring the Identity Management Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prerequisites_2">Prerequisites</h3>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10003; The Mobile Metrics Service and Identity Management Service must be provisioned in the same OpenShift project to access data.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_overview">Overview</h3>
<div class="paragraph">
<p>After the Mobile Metrics Service (includes Grafana for visualization and the Prometheus monitoring system) and Identity Management Service are provisioned,
you should be able to see the "Keycloak Metrics" in the list of available dashboards (navigate to Grafana&#8217;s exposed URL &#8594; Log in &#8594; Home &#8594; Select <strong>Keycloak Metrics</strong>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_dashboard_panel_descriptions">Dashboard panel descriptions</h3>
<div class="paragraph">
<p>The Keycloak dashboard consists of several panels which give you an overview of the specific
events, such as the number of registered users, memory usage etc.</p>
</div>
<div class="paragraph">
<p>Below you will find a detailed description of each panel and its values.</p>
</div>
</div>
<div class="sect2">
<h3 id="_singlestat_panels">Singlestat Panels</h3>
<div class="paragraph">
<p>Singlestat panels show you the main summary of a single data series.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Total Registrations</strong>: Total number of registered (non-admin) users. This number comprises all successful registrations made via various providers, e.g. Keycloak, Github, Facebook etc.</p>
</li>
<li>
<p><strong>Total Logins</strong>: Total number of successful logins (only non-admin users) over all providers.</p>
</li>
<li>
<p><strong>Total Login Errors</strong>: Total number of failed login attempts.</p>
</li>
<li>
<p><strong>Current Memory</strong>: The amount of memory currently used by the Identity Management Service</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_graph_panels">Graph panels</h3>
<div class="paragraph">
<p>Used to show how certain values change over time, e.g. the number of successful logins.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Logins</strong>: Overview of the successful logins over time</p>
</li>
<li>
<p><strong>Login Errors</strong>: Overview of the failed login attempts over time</p>
</li>
<li>
<p><strong>Memory Usage</strong>: The values in this graph represents the following:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Used</strong>: The amount of memory currently used by the Identity Management Service</p>
</li>
<li>
<p><strong>Commited</strong>: The amount of memory that is guaranteed to be available for use (by JVM)</p>
</li>
<li>
<p><strong>Max</strong>: The maximum amount of memory that can be used for memory management</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_pie_charts">Pie Charts</h3>
<div class="paragraph">
<p>Used to show the distribution of data, e.g. the number of logins per identity provider.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Logins Per Provider</strong>: Overview of the successful (non-admin) user logins per provider</p>
</li>
<li>
<p><strong>Registrations Per Provider</strong>: Overview of the successful (non-admin) user registrations per provider.</p>
</li>
</ul>
</div>
<h3 id="_related_information" class="discrete">Related Information</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.grafana.org/features/panels/singlestat/#singlestat-panel">Singlestat Panel, window="_blank"</a></p>
</li>
<li>
<p><a href="http://docs.grafana.org/features/panels/graph/#graph-panel">Graph Panel, window="_blank"</a></p>
</li>
<li>
<p><a href="https://grafana.com/plugins/grafana-piechart-panel">Pie Chart, window="_blank"</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-11-24 21:05:18 GMT
</div>
</div>
</body>
</html>