include::{partialsdir}/attributes.adoc[]

= Setting up {org-name} {product-name} on OpenShift

To use {product-name}, you must run OpenShift and install an add-on which enables {product-name}. For more information about OpenShift, see https://www.openshift.org/.

NOTE: {org-name} recommends running OpenShift using the method described here. However there are many ways to run OpenShift, and {product-name} is compatible with most of these methods. There is a known issue with Minishift that makes it unsuitable for mobile development. This issue is described in link:https://github.com/minishift/minishift/issues/1287[].

[[prerequisites]]
== Prerequisites

* MacOS or Linux
* A system capable of running OpenShift as described in link:https://github.com/openshift/origin/blob/master/docs/cluster_up_down.md#prerequisites[Local Cluster Management]

* A link:https://hub.docker.com/[Docker Hub] account

* link:https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html[Ansible] (version 2.4 or above)

* link:https://www.openshift.org/download.html[OpenShift client tools] version 3.9 or later
+
WARNING: OpenShift oc executable must be located in a system location that is known to all shells (e.g. /usr/local/bin)
+
NOTE: Ensure that you can run link:https://github.com/openshift/origin/blob/master/docs/cluster_up_down.md#getting-started[oc cluster up] with no errors before moving on to the installation of AeroGear.
+
For Linux (Fedora) we also need to add an extra port to the `dockerc` zone:
[source,sh]
----
firewall-cmd --permanent --zone dockerc --add-port 443/tcp
firewall-cmd --reload
----



[[procedure]]
== Procedure

. Clone the Mobile-core installer:
+
We configure the local development installation of {org-name} {product-name} using ansible scripts in our link:https://github.com/aerogear/mobile-core[mobile-core] repo. Clone this repo to your local machine and check out the {release-number} tag using:
+
[source,bash,subs="attributes"]
----
git clone git@github.com:aerogear/mobile-core.git
cd mobile-core
git checkout {release-number}
----

. Perform the installation:
+
In the cloned repository, run the installer with the following command:
+
[source,bash]
----
./installer/install.sh
----
+
This validates that Ansible, Docker and the OpenShift Client Tools
are installed and are the right version.
+
Once verified it prompts you for your Docker Hub login credentials, which
must be valid for the installation to continue.
+
The next set of values are optional and can be left with the default values.
+
[source,bash,subs="attributes"]
----
DockerHub Tag (Defaults to latest):
DockerHub Organisation (Defaults to aerogearcatalog):
Cluster IP (Defaults to <Network IP Address>
Wildcard DNS Host (Defaults to nip.io):
----
+
The first two values here are used to configure the service-catalog in the
resulting cluster to look at other docker registries or tags to fetch the
APBs from.
+
The *Cluster IP* defaults to the IP address of your primary network interface. If you want to connect to your OPenShift instance from a mobile device, you will need to ensure that your device is on the same network. For this reason, it is usally best to ensure you are using the IP Address of your Wireless Adapter (if one exists).
+
The *Wildcard DNS Host* option alters the wildcard DNS host you wish
to use.
+
All of these values can be left at their defaults, unless you have a specific reason to change them (e.g. installing a specific version of {product-name}).
+
. Check the installation logs:
+
The following installation can take a while the first time it runs as it pulls a number of docker images. Once completed successfully, this will end with output similar to:
+
----
TASK [output-oc-cluster-status : debug] ******************************************************************************************************************************************************
ok: [localhost] => {
    "msg": [
        "Web console URL: https://192.168.37.1:8443/console/",
        "",
        "Config is at host directory /var/lib/origin/openshift.local.config",
        "Volumes are at host directory /var/lib/origin/openshift.local.volumes",
        "Persistent volumes are at host directory /var/lib/origin/openshift.local.pv",
        "Data is at host directory /path/to/mobile-core/ui/openshift-data"
    ]
}

PLAY RECAP ***********************************************************************************************************************************************************************************
localhost                  : ok=44   changed=17   unreachable=0    failed=0
----
+
Which signifies that your installation has completed successfully.

. Verify the installation:
+
.. Open a browser and (accepting the self-signed certificate) login:
+
----
https://192.168.37.1:8443/console/
----
+
The developer login credentials are:
+
----
username: developer
password: password
----

.. At the top of the catalog package, find the *Mobile* category that indicates that the mobile features of {org-name} {product-name} are succesfully installed.

image:catalog-mobile-clients.png[]
